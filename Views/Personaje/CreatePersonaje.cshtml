@model juegoCartas_net.Models.Personaje
@{
    ViewData["Title"] = "Create";
}

<div class="container mt-4">
    <div class="row">
        <!-- caras  -->
        <div class="col-md-3">
            <h5 class="text-white text-center">Caras</h5>
            <div id="cardContainerCara" class="card-grid"></div>
        </div>

         @* personaje *@
        <div class="col-md-6 d-flex flex-column align-items-center">
            <form asp-action="CrearCarta" asp-controller="Carta" enctype="multipart/form-data" method="post"
                class="w-100">
                <h5 class="text-center">Personaje Seleccionado</h5>
                <div id="cardContainerPesonaje" class="personaje-vista mb-3"></div>

              
                    <input type="submit" value="Crear Carta" class="btn btn-dark" />
                
            </form>
        </div>

        <!-- cabezas -->
        <div class="col-md-3">
            <h5 class="text-white text-center">Cabezas</h5>
            <div id="cardContainerCabeza" class="card-grid"></div>
        </div>
    </div>

    <!-- cuerpos-->
    <div class="row mt-4">
        <div class="col-12">
            <h5 class="text-center">Cuerpos</h5>
            <div id="cardContainer" class="card-grid-horizontal justify-content-center"></div>
        </div>
    </div>
</div>


@section Scripts {
    <script>

        $(document).ready(function () {
            $.get("@Url.Action("ObtenerPersonaje", "Personaje")")
                .done(function (res) {

                    if (res.personajejson) {
                        $("#cardContainerPesonaje").empty();

                        var personaje = res.personajejson;

                        var card = renderPersonaje(personaje);
                        $("#cardContainerPesonaje").append(card);
                    } else {
                        $("#cardContainerPesonaje").html("<h2>No se encontraron partes.</h2>");
                    }

                });
        });

        $(document).ready(function () {
            $.get("@Url.Action("ObtenerPartes", "Personaje")")
                .done(function (res) {
                    if (res.carajson && res.carajson.length > 0) {
                        $("#cardContainerCara").empty(); 
                        for (let i = 0; i < res.carajson.length; i++) {
                            var parte = res.carajson[i];

                            if (i == 0) { clase = "caraIdSelect" } else {

                            };
                            var card = $(`
                                                                                     <button onclick=cambioCara(${parte.id})>
                                                                                            <div class="card">
                                   
                                                                                                <img src="${parte.imagen}" class="card-img" alt="${parte.nombre}">
                                        
                                                                                                <div class="card-body">
                                                                                                    <h2 class="card-title">${parte.nombre}</h2>
                                                                                                     <input id="caraId" type= "hidden" value=${parte.id} />
                                                                                                    <p class="card-text"><strong>Característica:</strong> ${parte.caracteristica}</p>
                                                                                                </div>
                                                                                            </div>
                                                                                              </button>
                                                                                        `);
                            $("#cardContainerCara").append(card);
                        };
                    } else {
                        $("#cardContainerCara").append("<h2>No se encontraron partes.<h2>");
                    }

                    if (res.cabezajson && res.cabezajson.length > 0) {
                        $("#cardContainerCabeza").empty();

                        for (let i = 0; i < res.cabezajson.length; i++) {
                            var parte = res.cabezajson[i];
                            var clase = "";
                            if (i == 0) { clase = "cabezaIdSelect" } else {
                                clase = "cabezaId"
                            };
                            var card = $(`
                                                                     <button onclick=cambioCabeza(${parte.id})>
                                                                                            <div class="card">
                                                                                                <img src="${parte.imagen}" class="card-img" alt="${parte.nombre}">
                                                                                                <div class="card-body">
                                                                                                    <h2 class="card-title">${parte.nombre}</h2>
                                                                                                   <input id="cabezaId" type= "hidden" value=${parte.id}  />
                                                                                                    <p class="card-text"><strong>Característica:</strong> ${parte.caracteristica}</p>
                                                                                                </div>
                                                                                            </div>
                                                                                              </button>
                                                                                        `);
                            $("#cardContainerCabeza").append(card);
                        };
                    } else {
                        $("#cardContainerCabeza").append("<h2>No se encontraron partes.<h2>");
                    }

                    if (res.cuerpojson && res.cuerpojson.length > 0) {
                        $("#cardContainer").empty(); 


                        for (let i = 0; i < res.cuerpojson.length; i++) {
                            var parte = res.cuerpojson[i];
                            var clase = "";
                            if (i == 0) { clase = "cuerpoIdSelect" } else {
                                clase = "cuerpoId"
                            };
                            var card = $(`
                                                                     <button onclick=cambioCuerpo(${parte.id})>
                                                                                            <div class="card">
                                                                                                <img src="${parte.imagen}" class="card-img" alt="${parte.nombre}">
                                                                                                <div class="card-body">
                                                                                                    <h2 class="card-title" >${parte.nombre}</h2>
                                                                                                   <input id= "cuerpoId"  type= "hidden" ${parte.id}/>
                                                                                                    <p class="card-text"><strong>Característica:</strong> ${parte.caracteristica}</p>
                                                                                                </div>
                                                                                            </div>
                                                                                              </button>
                                                                                        `);
                            $("#cardContainer").append(card);
                        };
                    } else {
                        $("#cardContainer").append("<h2>No se encontraron partes.<h2>");
                    }

                })
                .fail(function (err) {
                    console.error("Error al obtener las partes:", err);
                });
        });

        function cambioCara(idCara) {
            var cabezaId = document.getElementById('idCabezaPersonaje').value;
            var cuerpoId = document.getElementById('idCuerpoPersonaje').value;

            $.ajax({
                url: '/Personaje/cambio',
                type: 'GET',
                data: {
                    cara: idCara,
                    cabeza: cabezaId,
                    cuerpo: cuerpoId
                },
                success: function (res) {
                    console.log("Respuesta del servidor:", res);
                    if (res.personajejson) {
                        $("#cardContainerPesonaje").empty();

                        var personaje = res.personajejson;
                        var card = renderPersonaje(personaje);

                        $("#cardContainerPesonaje").append(card);
                    } else {
                        $("#cardContainerPesonaje").html("<h2>No se encontraron partes.<h2>");
                    }

                },
                error: function () {
                    $("#cardContainerPesonaje").html("<h2>Error al obtener el personaje.<h2>");
                }
            });
        };

        function cambioCabeza(idCabeza) {
            var caraId = document.getElementById('idCaraPersonaje').value;
            var cuerpoId = document.getElementById('idCuerpoPersonaje').value;

            $.ajax({
                url: '/Personaje/cambio',
                type: 'GET',
                data: {
                    cara: caraId,
                    cabeza: idCabeza,
                    cuerpo: cuerpoId
                },
                success: function (res) {
                    console.log("Respuesta del servidor:", res);
                    if (res.personajejson) {
                        $("#cardContainerPesonaje").empty();

                        var personaje = res.personajejson;


                        var card = renderPersonaje(personaje);
                        $("#cardContainerPesonaje").append(card);
                    } else {
                        $("#cardContainerPesonaje").html("<h2>No se encontraron partes.<h2>");
                    }

                },
                error: function () {
                    $("#cardContainerPesonaje").html("<h2>Error al obtener el personaje.<h2>");
                }
            });
        };
        function cambioCuerpo(idCuerpo) {
            var caraId = document.getElementById('idCaraPersonaje').value;
            var cabezaId = document.getElementById('idCabezaPersonaje').value;

            $.ajax({
                url: '/Personaje/cambio',
                type: 'GET',
                data: {
                    cara: caraId,
                    cabeza: cabezaId,
                    cuerpo: idCuerpo
                },
                success: function (res) {
                    console.log("Respuesta del servidor:", res);
                    if (res.personajejson) {
                        $("#cardContainerPesonaje").empty();

                        var personaje = res.personajejson;

                        var card = renderPersonaje(personaje);

                        $("#cardContainerPesonaje").append(card);
                    } else {
                        $("#cardContainerPesonaje").html("<h2>No se encontraron partes.<h2>");
                    }

                },
                error: function () {
                    $("#cardContainerPesonaje").html("<h2>Error al obtener el personaje.<h2>");
                }
            });
        };

        function renderPersonaje(personaje) {
           var tipo= null;
            if(personaje.tipo==0 ){
                tipo= "Mele"
            }else{
                tipo="Rango"
            }

        
            return $(`
                            <div class="text-center">
                                <div class="mb-2">
                                <img src="${personaje.imagen}" value="${personaje.imagen}" name ="imagen" class="img-fluid rounded shadow" alt="${personaje.nombre}" >
                                </div>
                                <h5 class="text-dark">${personaje.nombre}</h5>
                                <h6 class="text-dark">Ataque: ${personaje.ataque}</h6>
                                <h6 class="text-dark">Habilidad: ${tipo}</h6>
                                <h6 class="text-dark">Vida: ${personaje.vida}</h6>
                                <input id="idCaraPersonaje" type="hidden" value="${personaje.caraId}" />
                                <input id="idCabezaPersonaje" type="hidden" value="${personaje.cabezaId}" />
                                <input id="idCuerpoPersonaje" type="hidden" value="${personaje.cuerpoId}" />
                                <input id="personajeId" name="personajeId" type="hidden" value="${personaje.id}" />
                                <input id="imagen" name="imagen" type="hidden" value="${personaje.imagen}" />
                            </div>
                        `);
        }

    </script>

    <style>
        html,
        body {
            display: grid;
            height: 100%;
            width: 100%;
            place-items: center;
            background: linear-gradient(375deg, #797979, #000000);
        }

        button {
            border: none;
            background-color:transparent;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
        }

        .card-grid-horizontal {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .card button,
        .card {
            all: unset;
            cursor: pointer;
            display: block;
        }

        .card {
            border-style: solid;
            width: 100%;
            max-width: 100px;
            border-color: rgb(87, 87, 87);
            border-radius: 12px;
            overflow: hidden;
            background-color: white;
            box-shadow: none;
            transition: transform 0.2s;
            text-align: center;
            display: flex;
            flex-direction: column;
              font-size: 0.2rem;

        }

        .card:hover {
            transform: translateY(-4px);
        }

        .card-body {
            padding: 6px 8px;
            font-size: 0.75rem;
            background-color: white;
            border-color: red;
        }

        .card-title {
            font-weight: bold;
            font-size: 0.8rem;
            margin-bottom: 2px;
        }

        .card-text {
            font-size: 0.7rem;

            line-height: 1.2;
        }
 h4 {
            font-size: 1.10rem;

            line-height: 1.2;
        }


        .card-img {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 12px 12px 0 0;
        }





        .personaje-vista {

            text-align: center;
            @* padding: 5px; *@
            border: 2px dashed #ccc;
            border-radius: 12px;
            min-height: 200px;
            /* Aumenta la altura mínima del contenedor */
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .personaje-vista img {

            max-height: 300px;
            /* Aumenta esto si lo deseas aún más grande */
            max-width: 100%;
            object-fit: contain;
            border-radius: 10px;
        }

        form {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        form .btn-primary {
            min-width: 150px;
            font-size: 1rem;
            padding: 8px 16px;
        }
    </style>

}
